rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // 관리자 이메일 (실제 관리자 이메일로 교체하세요)
    function isAdmin() {
      return request.auth != null && 
             request.auth.token.email == '0521kimyi@gmail.com';  // 여기에 실제 관리자 이메일 입력
    }

    // Users: 관리자는 모든 사용자 데이터 읽기/쓰기 가능, 일반 사용자는 자신의 데이터만
    match /users/{userId} {
      allow read: if request.auth != null && (request.auth.uid == userId || isAdmin());
      allow write: if request.auth != null && (request.auth.uid == userId || isAdmin());

      // pointHistory는 반드시 users/{userId} 내부에 중첩
      match /pointHistory/{docId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }
    }

    // Diaries: Users can only read/write their own diaries.
    match /diaries/{diaryId} {
      allow read, update, delete: if request.auth != null && request.auth.uid == resource.data.userId;
      allow create: if request.auth != null && request.auth.uid == request.resource.data.userId;
    }

    // Novels: Users can only read/write their own novels.
    // The novelId is structured as {userId}_{year}_{month}_{weekNum}
    match /novels/{novelId} {
      allow read, write: if true;
    }
  }
} 