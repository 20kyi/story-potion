# 인앱 결제 문제 해결 가이드

## 현재 상황
인앱 결제 버튼을 누르면 "인앱 결제에 실패했습니다" 메시지가 표시되고, 결제 창이 뜨지 않습니다.

## 가능한 원인들

### 1. Google Play Console 설정 문제 (가장 가능성 높음)
- **상품이 등록되지 않음**: Google Play Console에서 상품 ID가 등록되어 있어야 합니다.
  - 포인트 상품: `points_100`, `points_500`, `points_1000`, `points_2000`
  - 구독 상품: `premium_monthly`, `premium_yearly`
- **앱이 제대로 등록되지 않음**: 앱이 Google Play Console에 등록되어 있고, 내부 테스트/알파/베타 트랙에 업로드되어 있어야 합니다.

### 2. 서명 문제
- **디버그 빌드**: 디버그 키로 서명된 앱은 Google Play Console에 등록된 앱과 서명이 다릅니다.
  - 해결: 릴리즈 키로 서명하거나, Google Play Console에서 디버그 서명 키를 등록해야 합니다.
- **서명 키 불일치**: 앱 서명 키가 Google Play Console에 등록된 키와 일치해야 합니다.

### 3. 테스트 계정 문제
- **테스트 계정 미설정**: Google Play Console에서 테스트 계정으로 설정된 계정으로만 테스트할 수 있습니다.
  - 설정 위치: Google Play Console > 설정 > 라이선스 테스트

### 4. 상품 ID 불일치
- 코드의 상품 ID와 Google Play Console의 상품 ID가 정확히 일치해야 합니다.
- 대소문자도 정확히 일치해야 합니다.

### 5. Google Play Services 문제
- Google Play Services가 설치되어 있지 않거나 업데이트되지 않았을 수 있습니다.

## 확인 방법

### 1. 로그 확인
앱을 실행하고 포인트 충전을 시도한 후, 다음 로그를 확인하세요:

**JavaScript 콘솔 (Chrome DevTools 또는 React Native Debugger):**
```
[인앱결제] initialize 시작
[인앱결제] Billing.initialize 결과
[인앱결제] purchaseProduct 시작
[인앱결제] Billing.purchaseProduct 호출 시작
[인앱결제] Billing.purchaseProduct 결과
```

**Android Logcat:**
```bash
adb logcat | grep BillingPlugin
```

### 2. 확인해야 할 로그 메시지
- `[인앱결제] 초기화 완료` - 초기화가 성공했는지
- `[인앱결제] 상품 정보 조회 실패` - 상품이 등록되어 있는지
- `[인앱결제] launchBillingFlow 실패` - 결제 창을 열 수 있는지
- `ResponseCode` - 어떤 에러 코드가 반환되는지

### 3. 일반적인 에러 코드
- **ITEM_UNAVAILABLE (4)**: 상품을 찾을 수 없음 → Google Play Console에서 상품 등록 확인
- **SERVICE_UNAVAILABLE (2)**: Google Play 서비스 사용 불가 → 네트워크/서비스 확인
- **BILLING_UNAVAILABLE (3)**: 인앱 결제 사용 불가 → Google Play Services 확인
- **DEVELOPER_ERROR (5)**: 개발자 설정 오류 → 서명 키 확인

## 해결 방법

### 1단계: Google Play Console 확인
1. Google Play Console에 로그인
2. 앱 선택 > 수익 창출 > 앱 내 상품
3. 상품 ID가 등록되어 있는지 확인:
   - `points_100` (일회성 구매)
   - `points_500` (일회성 구매)
   - `points_1000` (일회성 구매)
   - `points_2000` (일회성 구매)
   - `premium_monthly` (구독)
   - `premium_yearly` (구독)

### 2단계: 앱 서명 확인
1. Google Play Console > 앱 서명 확인
2. 디버그 빌드로 테스트하는 경우:
   - 앱 서명 > 앱 서명 키 인증서 SHA-1 복사
   - 또는 릴리즈 키로 서명하여 테스트

### 3단계: 테스트 계정 설정
1. Google Play Console > 설정 > 라이선스 테스트
2. 테스트 계정 추가 (Gmail 주소)
3. 해당 계정으로 앱 설치 및 테스트

### 4단계: 앱 업로드
- 최소한 내부 테스트 트랙에 앱을 업로드해야 인앱 결제가 작동합니다.
- 디버그 빌드만으로는 테스트가 제한적일 수 있습니다.

## 임시 해결책 (개발 중)
개발 중에는 인앱 결제를 우회할 수 있지만, **프로덕션에서는 반드시 실제 인앱 결제를 사용해야 합니다.**

## 다음 단계
1. 로그를 확인하여 정확한 에러 메시지 파악
2. Google Play Console 설정 확인
3. 필요시 앱을 내부 테스트 트랙에 업로드
4. 테스트 계정으로 재테스트

